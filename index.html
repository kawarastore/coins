<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KawaraStore - Jualan Coins</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Semua style CSS sebelumnya tetap sama */
        /* ... (CSS sebelumnya tetap di sini) ... */
        
        /* Tambahan untuk status online/offline */
        .admin-status-online {
            background: #00c853;
        }
        
        .admin-status-offline {
            background: #ff5252;
        }
        
        .admin-status-checking {
            background: #ffb300;
        }
        
        .online-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--dark-card);
        }
        
        .online-indicator.online {
            background: #00c853;
            box-shadow: 0 0 10px rgba(0, 200, 83, 0.5);
        }
        
        .online-indicator.offline {
            background: #ff5252;
        }
        
        .online-indicator.checking {
            background: #ffb300;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .status-update {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        /* WhatsApp Status Indicator */
        .whatsapp-status-container {
            background: rgba(20, 22, 28, 0.7);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 15px;
            margin: 20px auto;
            max-width: 1200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }
        
        .whatsapp-status-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .whatsapp-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .whatsapp-status.online {
            background: rgba(0, 200, 83, 0.2);
            color: #00c853;
            border: 1px solid rgba(0, 200, 83, 0.3);
        }
        
        .whatsapp-status.offline {
            background: rgba(255, 82, 82, 0.2);
            color: #ff5252;
            border: 1px solid rgba(255, 82, 82, 0.3);
        }
        
        .last-check {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <header>
        <h1><i class="fas fa-coins"></i> KAWARA STORE</h1>
        <p>Jualan Coins Fish It - Status Admin Real-Time</p>
    </header>

    <!-- WhatsApp Status Indicator -->
    <div class="whatsapp-status-container" id="whatsapp-status-container">
        <div class="whatsapp-status-title">
            <i class="fab fa-whatsapp"></i>
            <span>Status WhatsApp Global</span>
        </div>
        <span class="whatsapp-status" id="global-whatsapp-status">Mengecek...</span>
        <div class="last-check" id="last-check-time">Terakhir dicek: -</div>
        <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
            <i class="fas fa-info-circle"></i> Jika WhatsApp offline, status admin juga akan otomatis offline
        </p>
    </div>

    <div class="tab-container">
        <!-- ... (kode HTML sebelumnya tetap sama) ... -->
        
        <!-- Tab Contents -->
        <div id="coins" class="tab-content active">
            <!-- ... (kode sebelumnya) ... -->
        </div>

        <div id="admins" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-user-tie"></i> PILIH ADMIN</h2>
                <p style="margin-bottom: 20px; opacity: 0.8;">
                    Status admin diperbarui secara real-time. Jika WhatsApp admin offline, status akan otomatis berubah menjadi offline.
                </p>
                
                <div class="admins-grid" id="admins-grid">
                    <!-- Admin akan di-generate oleh JavaScript -->
                </div>
            </div>
        </div>

        <!-- ... (sisa HTML sebelumnya tetap sama) ... -->
    </div>

    <footer>
        <p>&copy; 2025 KawaraStore. All rights reserved.</p>
        <p>Status online/offline diperbarui otomatis setiap 2 menit</p>
    </footer>

    <div class="notification" id="notification">
        <span id="notification-text"></span>
    </div>

    <script>
        // Data admin yang tersedia - DIPERBARUI dengan URL check
        const admins = [
            {
                id: 1,
                name: "Admin Zycho",
                phone: "6281928617289",
                avatar: "R",
                paymentMethods: ["DANA"],
                paymentNotes: "Transfer Manual, konfirmasi cepat",
                coinsPrice: {
                    "1M": 15000,
                    "2M": 30000,
                    "3M": 45000,
                    "4M": 60000,
                    "5M": 75000
                },
                // WhatsApp check URL (menggunakan wa.me)
                waCheckUrl: "https://wa.me/6281928617289",
                lastStatus: "checking", // 'online', 'offline', 'checking'
                lastChecked: null
            },
            {
                id: 2,
                name: "Admin 1Bay",
                phone: "6282125688558",
                avatar: "S",
                paymentMethods: ["DANA"],
                paymentNotes: "Transfer Manual, konfirmasi cepat",
                coinsPrice: {
                    "1M": 15000,
                    "2M": 30000,
                    "3M": 45000,
                    "4M": 60000,
                    "5M": 75000
                },
                waCheckUrl: "https://wa.me/6282125688558",
                lastStatus: "checking",
                lastChecked: null
            }
        ];

        // Data coins yang tersedia
        const coinsList = [
            { amount: "1M", label: "1 Juta Coins", icon: "fa-coins" },
            { amount: "2M", label: "2 Juta Coins", icon: "fa-coins" },
            { amount: "3M", label: "3 Juta Coins", icon: "fa-coins" },
            { amount: "4M", label: "4 Juta Coins", icon: "fa-coins" },
            { amount: "5M", label: "5 Juta Coins", icon: "fa-coins" },
        ];

        // Variabel global untuk pilihan
        let selectedCoin = null;
        let selectedAdmin = null;
        let selectedCoinPrice = 0;
        let selectedCoinAmount = "";
        let selectedAdminName = "";
        let selectedAdminPhone = "";
        
        // Variabel untuk status check
        let isChecking = false;
        let lastGlobalCheck = null;

        // Tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Setup tab buttons
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Generate coins list
            generateCoinsList();
            
            // Generate admins list
            generateAdminsList();
            
            // Setup username input
            const usernameInput = document.getElementById('username');
            usernameInput.addEventListener('input', checkOrderButton);
            
            // Setup order button
            const orderButton = document.getElementById('order-btn');
            orderButton.addEventListener('click', placeOrder);
            
            // Mulai pengecekan status
            checkAllWhatsAppStatus();
            
            // Update status setiap 2 menit
            setInterval(checkAllWhatsAppStatus, 120000);
            
            // Update waktu last check setiap menit
            setInterval(updateLastCheckTime, 60000);
        });
        
        // Fungsi untuk mengecek status WhatsApp semua admin
        async function checkAllWhatsAppStatus() {
            if (isChecking) return;
            
            isChecking = true;
            updateGlobalStatus("Mengecek...", "checking");
            
            const promises = admins.map(admin => checkWhatsAppStatus(admin.id));
            
            try {
                await Promise.all(promises);
                updateGlobalStatus("Semua Admin Online", "online");
            } catch (error) {
                // Cek apakah ada admin yang online
                const anyOnline = admins.some(admin => admin.lastStatus === 'online');
                if (anyOnline) {
                    updateGlobalStatus("Beberapa Admin Online", "online");
                } else {
                    updateGlobalStatus("Semua Admin Offline", "offline");
                }
            } finally {
                isChecking = false;
                lastGlobalCheck = new Date();
                updateLastCheckTime();
                
                // Update tampilan admin
                generateAdminsList();
                
                // Jika admin yang dipilih offline, reset pilihan
                if (selectedAdmin && selectedAdmin.lastStatus === 'offline') {
                    showNotification(`Admin ${selectedAdminName} sedang offline. Silakan pilih admin lain.`);
                    resetSelectedAdmin();
                }
            }
        }
        
        // Fungsi untuk mengecek status WhatsApp per admin
        async function checkWhatsAppStatus(adminId) {
            return new Promise((resolve, reject) => {
                const admin = admins.find(a => a.id === adminId);
                if (!admin) {
                    reject(new Error('Admin tidak ditemukan'));
                    return;
                }
                
                // Simulasi pengecekan status WhatsApp
                // Dalam implementasi nyata, ini akan menggunakan API atau service
                // Untuk demo, kita gunakan simulasi dengan 80% chance online
                const isOnline = Math.random() > 0.2; // 80% chance online
                
                // Update status admin
                admin.lastStatus = isOnline ? 'online' : 'offline';
                admin.lastChecked = new Date();
                
                // Untuk demo, tambahkan delay 1-2 detik
                setTimeout(() => {
                    if (isOnline) {
                        resolve(admin);
                    } else {
                        reject(new Error(`${admin.name} offline`));
                    }
                }, 500 + Math.random() * 1500);
            });
        }
        
        // Update status global
        function updateGlobalStatus(text, status) {
            const statusElement = document.getElementById('global-whatsapp-status');
            const container = document.getElementById('whatsapp-status-container');
            
            statusElement.textContent = text;
            statusElement.className = `whatsapp-status ${status}`;
            
            // Update warna container berdasarkan status
            if (status === 'online') {
                container.style.borderColor = 'rgba(0, 200, 83, 0.3)';
            } else if (status === 'offline') {
                container.style.borderColor = 'rgba(255, 82, 82, 0.3)';
            } else {
                container.style.borderColor = 'rgba(255, 179, 0, 0.3)';
            }
        }
        
        // Update waktu terakhir pengecekan
        function updateLastCheckTime() {
            const lastCheckElement = document.getElementById('last-check-time');
            if (lastGlobalCheck) {
                const now = new Date();
                const diffMs = now - lastGlobalCheck;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) {
                    lastCheckElement.textContent = 'Terakhir dicek: Baru saja';
                } else if (diffMins === 1) {
                    lastCheckElement.textContent = 'Terakhir dicek: 1 menit lalu';
                } else {
                    lastCheckElement.textContent = `Terakhir dicek: ${diffMins} menit lalu`;
                }
            }
        }
        
        // Generate coins list (sama seperti sebelumnya)
        function generateCoinsList() {
            const coinsGrid = document.getElementById('coins-grid');
            coinsGrid.innerHTML = '';
            
            coinsList.forEach(coin => {
                const coinCard = document.createElement('div');
                coinCard.className = 'item-card';
                coinCard.setAttribute('data-amount', coin.amount);
                coinCard.setAttribute('data-label', coin.label);
                
                coinCard.innerHTML = `
                    <h3><i class="fas ${coin.icon}"></i> ${coin.label}</h3>
                    <div class="coin-amount">${coin.amount}</div>
                    <div class="price" id="price-${coin.amount}">Pilih admin untuk melihat harga</div>
                    <div class="description">Klik untuk memilih paket coins ini</div>
                `;
                
                coinCard.addEventListener('click', function() {
                    if (!canSelectItem()) return;
                    
                    // Remove selection from all coin cards
                    document.querySelectorAll('#coins-grid .item-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // Add selection to clicked card
                    this.classList.add('selected');
                    
                    // Get coin data
                    selectedCoinAmount = this.getAttribute('data-amount');
                    selectedCoin = this.getAttribute('data-label');
                    
                    // Update form
                    document.getElementById('selected-coin').value = selectedCoin;
                    
                    // Update price if admin is selected
                    if (selectedAdmin) {
                        updatePrice();
                    }
                    
                    // Check if order button should be enabled
                    checkOrderButton();
                });
                
                coinsGrid.appendChild(coinCard);
            });
        }
        
        // Generate admins list - DIPERBARUI dengan status
        function generateAdminsList() {
            const adminsGrid = document.getElementById('admins-grid');
            adminsGrid.innerHTML = '';
            
            admins.forEach(admin => {
                const adminCard = document.createElement('div');
                adminCard.className = 'admin-card';
                adminCard.setAttribute('data-admin-id', admin.id);
                
                // Tentukan status dan class
                const statusClass = `admin-status-${admin.lastStatus || 'checking'}`;
                const statusText = admin.lastStatus === 'online' ? 'Online' : 
                                  admin.lastStatus === 'offline' ? 'Offline' : 'Mengecek...';
                
                // Generate payment icons HTML
                const paymentIcons = admin.paymentMethods.map(method => {
                    return `<div class="payment-icon"><i class="fas fa-wallet"></i> ${method}</div>`;
                }).join('');
                
                adminCard.innerHTML = `
                    <div class="online-indicator ${admin.lastStatus || 'checking'}"></div>
                    <div class="admin-header">
                        <div class="admin-avatar">${admin.avatar}</div>
                        <div class="admin-info">
                            <h4>${admin.name}</h4>
                            <div class="admin-status ${statusClass}">${statusText}</div>
                        </div>
                    </div>
                    <p style="margin-bottom: 10px; font-size: 0.9rem;"><i class="fas fa-phone"></i> ${admin.phone}</p>
                    <div class="payment-methods">
                        <p><i class="fas fa-credit-card"></i> Metode Pembayaran:</p>
                        <div class="payment-icons">
                            ${paymentIcons}
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.85rem; opacity: 0.8;"><i class="fas fa-info-circle"></i> ${admin.paymentNotes}</p>
                    ${admin.lastChecked ? `<div class="status-update"><i class="fas fa-clock"></i> ${formatTime(admin.lastChecked)}</div>` : ''}
                `;
                
                // Hanya bisa diklik jika online
                if (admin.lastStatus === 'online') {
                    adminCard.style.cursor = 'pointer';
                    adminCard.addEventListener('click', function() {
                        selectAdmin(admin);
                    });
                } else {
                    adminCard.style.opacity = '0.7';
                    adminCard.style.cursor = 'not-allowed';
                    adminCard.addEventListener('click', function() {
                        showNotification(`Admin ${admin.name} sedang offline. Silakan pilih admin lain.`);
                    });
                }
                
                adminsGrid.appendChild(adminCard);
            });
        }
        
        // Fungsi untuk memilih admin
        function selectAdmin(admin) {
            // Remove selection from all admin cards
            document.querySelectorAll('#admins-grid .admin-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Get admin card element
            const adminCard = document.querySelector(`.admin-card[data-admin-id="${admin.id}"]`);
            if (adminCard) {
                adminCard.classList.add('selected');
            }
            
            selectedAdmin = admin;
            selectedAdminName = admin.name;
            selectedAdminPhone = admin.phone;
            
            // Update form
            document.getElementById('selected-admin').value = selectedAdminName;
            
            // Update prices for all coins
            updateAllCoinPrices();
            
            // Update current price if coin is selected
            if (selectedCoin) {
                updatePrice();
            }
            
            // Check if order button should be enabled
            checkOrderButton();
            
            showNotification(`Admin ${admin.name} dipilih`);
        }
        
        // Fungsi untuk reset pilihan admin
        function resetSelectedAdmin() {
            document.querySelectorAll('#admins-grid .admin-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            selectedAdmin = null;
            selectedAdminName = "";
            selectedAdminPhone = "";
            
            document.getElementById('selected-admin').value = "";
            document.getElementById('coin-summary').textContent = "0";
            document.getElementById('price-summary').textContent = "Rp 0";
            document.getElementById('total-summary').textContent = "Rp 0";
            
            checkOrderButton();
        }
        
        // Cek apakah item bisa dipilih
        function canSelectItem() {
            return !isChecking;
        }
        
        // Format waktu
        function formatTime(date) {
            if (!date) return '';
            const d = new Date(date);
            return `Diperbarui: ${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
        }
        
        // Update price for selected coin
        function updatePrice() {
            if (selectedAdmin && selectedCoinAmount) {
                selectedCoinPrice = selectedAdmin.coinsPrice[selectedCoinAmount] || 0;
                
                // Update price display on coin card
                const priceElement = document.querySelector(`#price-${selectedCoinAmount}`);
                if (priceElement) {
                    priceElement.textContent = formatRupiah(selectedCoinPrice);
                    priceElement.style.color = "var(--accent)";
                }
                
                // Update summary
                document.getElementById('coin-summary').textContent = selectedCoinAmount;
                document.getElementById('price-summary').textContent = formatRupiah(selectedCoinPrice);
                document.getElementById('total-summary').textContent = formatRupiah(selectedCoinPrice);
            }
        }
        
        // Update all coin prices when admin is selected
        function updateAllCoinPrices() {
            coinsList.forEach(coin => {
                const priceElement = document.querySelector(`#price-${coin.amount}`);
                if (priceElement && selectedAdmin) {
                    const price = selectedAdmin.coinsPrice[coin.amount] || 0;
                    priceElement.textContent = formatRupiah(price);
                    priceElement.style.color = "var(--accent)";
                }
            });
        }
        
        // Check if order button should be enabled
        function checkOrderButton() {
            const username = document.getElementById('username').value.trim();
            const orderButton = document.getElementById('order-btn');
            
            if (username && selectedCoin && selectedAdmin && selectedAdmin.lastStatus === 'online') {
                orderButton.disabled = false;
                orderButton.innerHTML = '<i class="fab fa-whatsapp"></i> Pesan via WhatsApp';
            } else {
                orderButton.disabled = true;
                if (selectedAdmin && selectedAdmin.lastStatus !== 'online') {
                    orderButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Admin Offline - Pilih Admin Lain';
                } else {
                    orderButton.innerHTML = '<i class="fab fa-whatsapp"></i> Pesan via WhatsApp';
                }
            }
        }
        
        // Format rupiah
        function formatRupiah(amount) {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }
        
        // Show notification
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }
        
        // Place order function
        function placeOrder() {
            const username = document.getElementById('username').value.trim();
            
            if (!username || !selectedCoin || !selectedAdmin) {
                showNotification('Harap lengkapi semua data pemesanan!');
                return;
            }
            
            // Pastikan admin online
            if (selectedAdmin.lastStatus !== 'online') {
                showNotification(`Admin ${selectedAdminName} sedang offline. Silakan pilih admin lain.`);
                return;
            }
            
            // Format pesan WhatsApp
            const message = `Halo ${selectedAdminName}, saya ingin membeli coins:
            
Username/ID Game: ${username}
Jumlah Coins: ${selectedCoin} (${selectedCoinAmount})
Harga: ${formatRupiah(selectedCoinPrice)}
Metode Pembayaran: ${selectedAdmin.paymentMethods.join(', ')}

Apakah coins ini tersedia?`;
            
            // Encode message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Create WhatsApp URL
            const whatsappURL = `https://wa.me/${selectedAdminPhone}?text=${encodedMessage}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappURL, '_blank');
            
            // Show success message
            showNotification(`Mengarahkan ke WhatsApp ${selectedAdminName}...`);
        }
        
        // Auto-select first coin and first online admin on page load
        setTimeout(() => {
            const firstCoin = document.querySelector('#coins-grid .item-card');
            if (firstCoin) {
                firstCoin.click();
            }
            
            // Cari admin online pertama
            const onlineAdmin = admins.find(admin => admin.lastStatus === 'online');
            if (onlineAdmin) {
                selectAdmin(onlineAdmin);
            }
        }, 1000);
    </script>
</body>
</html>
